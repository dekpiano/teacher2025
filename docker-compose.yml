version: "3.8"

services:
  app:
    container_name: teacher2025_app
    build: .
    ports:
      - "8084:443"
    volumes:
      # Use 'cached' for better read performance on Windows
      - .:/var/www/html:cached
      - d:/librarie_skj:/home/skjacth/domains/skj.ac.th/public_html/librarie_skj:cached
      # Use named volume for vendor to avoid slow Windows I/O
      - vendor_cache:/var/www/html/vendor
      # Cache writable directory for better performance
      - writable_cache:/var/www/html/writable
    environment:
      # Database connection settings for CodeIgniter
      DB_HOST: skj2025_db
      DB_PORT: 3306
      DB_USERNAME: root
      DB_PASSWORD: rootpassword
      # PHP Performance tuning
      PHP_OPCACHE_VALIDATE_TIMESTAMPS: 0
      PHP_REALPATH_CACHE_SIZE: 4096K
      PHP_REALPATH_CACHE_TTL: 600
    networks:
      - skj2025_default
    # Improve container performance
    tmpfs:
      - /tmp:size=256M
      - /var/cache:size=128M

networks:
  skj2025_default:
    external: true

volumes:
  vendor_cache:
    driver: local
  writable_cache:
    driver: local
